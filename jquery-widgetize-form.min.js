(function(e){e.fn.widgetizeForm=function(s){var r=this;if(!e(this).is("form"))throw".widgetizeForm() must be executed on a selection of forms.";r.data("widgetizeForm.settings",e.extend({},e.fn.widgetizeForm.defaults,s));r.on("submit",function(s){e.fn.widgetizeForm.onSubmit(s,r)})};e.fn.widgetizeForm.getJsonData=function(e){var s=e.serializeArray();var r={};for(var n=0;n<s.length;n++)r[s[n]["name"]]=s[n]["value"];return r};e.fn.widgetizeForm.clearMesssages=function(e){var s=e.data("widgetizeForm.settings");e.find(s.messageWrapper).html("");e.find(s.errorWrapper).html("")};e.fn.widgetizeForm.onSubmit=function(s,r){var n=r.attr("method"),a=e.fn.widgetizeForm.getJsonData(r),o=r.attr("action");s.preventDefault();e.fn.widgetizeForm.clearMesssages(r);if(n===undefined)n="GET";if(n!="GET")a=JSON.stringify(a);e.ajax({type:n,url:o,contentType:"application/json",data:a}).done(function(s,n,a){e.fn.widgetizeForm.onAJAXDone(r,s,n,a)}).fail(function(s,n,a){e.fn.widgetizeForm.onAJAXFail(r,s,n,a)})};e.fn.widgetizeForm.onAJAXDone=function(e,s,r,n){var a,o=e.data("widgetizeForm.settings");a=o.messages.fromResponse?s[o.response.keyMessage]:o.messages.success;e.find(o.messageWrapper).append('<div class="'+o.messages.classSuccess+'" role="alert">'+a+"</div>");if(o.resetOnSuccess){e.find("[name]").not('[type="hidden"]').val("").html("")}if(o.onSuccess!=null)o.onSuccess(s,r,n)};e.fn.widgetizeForm.onAJAXFail=function(e,s,r,n){var a,o,i,t=e.data("widgetizeForm.settings");if(s.status==0)a=t.messages.connectionRefused;else if(s.responseJSON===undefined)a=s.status>=500?t.messages.serverError:t.messages.error;else if(s.status>=500)a=t.messages.fromResponse?s.responseJSON[t.response.keyMessage]:t.messages.serverError;else if(s.status>=400)a=t.messages.fromResponse?s.responseJSON[t.response.keyMessage]:t.messages.error;e.find(t.messageWrapper).append('<div class="'+t.messages.classError+'" role="alert">'+a+"</div>");if(s.responseJSON!==undefined){o=s.responseJSON[t.response.keyErrors];if(o!==undefined){i=Object.keys(o);for(var f=0;f<i.length;f++){e.find('[name="'+i[f]+'"]').closest(t.inputWrapper).addClass(t.hasErrorClass).find(t.errorWrapper).append('<div class="'+t.errorClass+'">'+o[i[f]]+"</div>")}}}if(t.onError!=null)t.onError(s,r,n)};e.fn.widgetizeForm.defaults={inputWrapper:".form-group",errorWrapper:".input-error",messageWrapper:".messages",hasErrorClass:"has-error",errorClass:"help-inline help-alert",response:{keyMessage:"message",keyErrors:"errors"},messages:{fromResponse:false,classSuccess:"alert alert-success",classError:"alert alert-danger",success:"Success!",error:"There is an error in sent data.",serverError:"Server encountered an error.",connectionRefused:"Connection refused."},resetOnSuccess:true,onSuccess:null,onError:null}})(jQuery);